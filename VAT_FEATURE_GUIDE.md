# ЁЯУЛ р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М VAT р╣Гр╕Щр╕гр╕░р╕Ър╕Ъ POS

## тЬи **р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╣Гр╕лр╕бр╣И: р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕зр╕б VAT р╕лр╕гр╕╖р╕нр╣Др╕бр╣И**

р╕гр╕░р╕Ър╕Ъ POS р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╕зр╣Ир╕▓р╕Ир╕░р╕Др╕┤р╕Ф VAT 7% р╕лр╕гр╕╖р╕нр╣Др╕бр╣И

---

## ЁЯзо **р╕кр╕╣р╕Хр╕гр╕Др╕│р╕Щр╕зр╕У VAT р╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З:**

```
VAT = (р╕гр╕▓р╕Др╕▓р╕Чр╕нр╕З + р╕Др╣Ир╕▓р╕Бр╕│р╣Ар╕лр╕Щр╣Зр╕И - р╕кр╣Ир╕зр╕Щр╕ер╕Ф - р╣Ар╕Чр╕┤р╕гр╣Мр╕Щр╕Чр╕нр╕З) ├Ч 0.07
```

### **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У:**

1. **р╕вр╕нр╕Фр╕гр╕зр╕бр╕кр╕┤р╕Щр╕Др╣Йр╕▓** = ╬г(р╕гр╕▓р╕Др╕▓р╕Чр╕нр╕З + р╕Др╣Ир╕▓р╕Бр╕│р╣Ар╕лр╕Щр╣Зр╕И + р╕Др╣Ир╕▓р╕Юр╕ер╕нр╕в)
2. **р╕лр╕▒р╕Бр╕кр╣Ир╕зр╕Щр╕ер╕Ф** = р╕вр╕нр╕Фр╕гр╕зр╕б - р╕кр╣Ир╕зр╕Щр╕ер╕Ф
3. **р╕лр╕▒р╕Бр╣Ар╕Чр╕┤р╕гр╣Мр╕Щр╕Чр╕нр╕З** = (р╕лр╕ер╕▒р╕Зр╕лр╕▒р╕Бр╕кр╣Ир╕зр╕Щр╕ер╕Ф) - р╕бр╕╣р╕ер╕Др╣Ир╕▓р╣Ар╕Чр╕┤р╕гр╣Мр╕Щ
4. **р╕Др╕│р╕Щр╕зр╕У VAT** = (р╕лр╕ер╕▒р╕Зр╕лр╕▒р╕Бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф) ├Ч 0.07 (р╕Цр╣Йр╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕зр╕б VAT)
5. **р╕вр╕нр╕Фр╕Кр╕│р╕гр╕░** = (р╕лр╕ер╕▒р╕Зр╕лр╕▒р╕Бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф) + VAT

---

## ЁЯТ╗ **р╕зр╕┤р╕Шр╕╡р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Гр╕Щр╕лр╕Щр╣Йр╕▓ POS:**

### **1. р╕лр╕Щр╣Йр╕▓ POS р╕бр╕╡р╕Кр╣Ир╕нр╕З Checkbox р╣Гр╕лр╕бр╣И:**
- тЬЕ **р╣Ар╕ер╕╖р╕нр╕Б "р╕гр╕зр╕б VAT 7%"** тЖТ р╕Др╕┤р╕Ф VAT
- тЭМ **р╣Др╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Б** тЖТ р╣Др╕бр╣Ир╕Др╕┤р╕Ф VAT

### **2. р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З UI:**
р╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕Бр╕▓р╕гр╣Мр╕Ф **"р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Ф"** р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Б:
- р╕вр╕нр╕Фр╕гр╕зр╕б
- р╕кр╣Ир╕зр╕Щр╕ер╕Ф
- р╣Ар╕Чр╕┤р╕гр╣Мр╕Щр╕Чр╕нр╕З
- **тЖТ Checkbox "р╕гр╕зр╕б VAT 7%"** тЖР р╣Гр╕лр╕бр╣И!
- р╕вр╕нр╕Фр╕Кр╕│р╕гр╕░р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф

---

## ЁЯУК **р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У:**

### **р╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣И 1: р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕зр╕б VAT** тЬЕ

**р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓:**
- р╣Бр╕лр╕зр╕Щр╕Чр╕нр╕З: р╕гр╕▓р╕Др╕▓р╕Чр╕нр╕З 38,800 + р╕Др╣Ир╕▓р╕Бр╕│р╣Ар╕лр╕Щр╣Зр╕И 5,000 = 43,800 р╕Ър╕▓р╕Ч
- р╕кр╕гр╣Йр╕нр╕вр╕Др╕н: р╕гр╕▓р╕Др╕▓р╕Чр╕нр╕З 77,600 + р╕Др╣Ир╕▓р╕Бр╕│р╣Ар╕лр╕Щр╣Зр╕И 8,000 = 85,600 р╕Ър╕▓р╕Ч

**р╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У:**
```
р╕вр╕нр╕Фр╕гр╕зр╕б:        129,400 р╕Ър╕▓р╕Ч
р╕кр╣Ир╕зр╕Щр╕ер╕Ф:         -1,000 р╕Ър╕▓р╕Ч
р╣Ар╕Чр╕┤р╕гр╣Мр╕Щр╕Чр╕нр╕З:     -30,000 р╕Ър╕▓р╕Ч
----------------------------
р╕Рр╕▓р╕Щ VAT:        98,400 р╕Ър╕▓р╕Ч
VAT 7%:         +6,888 р╕Ър╕▓р╕Ч
============================
р╕вр╕нр╕Фр╕Кр╕│р╕гр╕░:       105,288 р╕Ър╕▓р╕Ч
```

### **р╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣И 2: р╣Др╕бр╣Ир╕гр╕зр╕б VAT** тЭМ

**р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ:**
```
р╕вр╕нр╕Фр╕гр╕зр╕б:        129,400 р╕Ър╕▓р╕Ч
р╕кр╣Ир╕зр╕Щр╕ер╕Ф:         -1,000 р╕Ър╕▓р╕Ч
р╣Ар╕Чр╕┤р╕гр╣Мр╕Щр╕Чр╕нр╕З:     -30,000 р╕Ър╕▓р╕Ч
----------------------------
р╕Рр╕▓р╕Щ VAT:        98,400 р╕Ър╕▓р╕Ч
VAT 7%:              0 р╕Ър╕▓р╕Ч (р╣Др╕бр╣Ир╕Др╕┤р╕Ф)
============================
р╕вр╕нр╕Фр╕Кр╕│р╕гр╕░:        98,400 р╕Ър╕▓р╕Ч
тЪая╕П р╕гр╕▓р╕Др╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕гр╕зр╕б VAT
```

---

## ЁЯОп **Use Cases:**

### **р╕Др╕зр╕гр╣Ар╕ер╕╖р╕нр╕Б "р╕гр╕зр╕б VAT":**
- тЬЕ р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Щр╕┤р╕Хр╕┤р╕Ър╕╕р╕Др╕Др╕е (р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Гр╕Ър╕Бр╕│р╕Бр╕▒р╕Ър╕ар╕▓р╕йр╕╡)
- тЬЕ р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Ар╕Др╕ер╕б VAT
- тЬЕ р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Ыр╕Бр╕Хр╕┤р╕Чр╕▒р╣Ир╕зр╣Др╕Ы

### **р╣Др╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Б "р╕гр╕зр╕б VAT":**
- тЭМ р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Чр╕▒р╣Ир╕зр╣Др╕Ы (Walk-in) р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Гр╕Ър╕Бр╕│р╕Бр╕▒р╕Ър╕ар╕▓р╕йр╕╡
- тЭМ р╕Вр╕▓р╕вр╕кр╣Ир╕З/р╕Вр╕▓р╕вр╕Ыр╕ер╕╡р╕Б (р╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕Хр╕Бр╕ер╕З)
- тЭМ р╕Бр╕гр╕Ур╕╡р╕Юр╕┤р╣Ар╕ир╕йр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Др╕┤р╕Ф VAT

---

## ЁЯТ╛ **р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Гр╕Щ Database:**

### **р╕Хр╕▓р╕гр╕▓р╕З `sales_transactions`:**

| Column | Type | р╕Др╕зр╕▓р╕бр╕лр╕бр╕▓р╕в |
|--------|------|----------|
| `vat_amount` | DECIMAL | р╕вр╕нр╕Ф VAT р╕Чр╕╡р╣Ир╕Др╕│р╕Щр╕зр╕Ур╣Др╕Фр╣Й |
| `include_vat` | BOOLEAN | р╕гр╕зр╕б VAT р╕лр╕гр╕╖р╕нр╣Др╕бр╣И (true/false) |
| `total_amount` | DECIMAL | р╕вр╕нр╕Фр╕Кр╕│р╕гр╕░р╕гр╕зр╕б VAT р╣Бр╕ер╣Йр╕з (р╕Цр╣Йр╕▓р╣Ар╕ер╕╖р╕нр╕Б) |

**р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е:**
```json
{
  "subtotal": 129400,
  "discount_amount": 1000,
  "trade_in_amount": 30000,
  "vat_amount": 6888,
  "include_vat": true,
  "total_amount": 105288
}
```

---

## ЁЯФД **р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Database:**

### **р╕Хр╣Йр╕нр╕Зр╕гр╕▒р╕Щ Migration Script:**

1. р╣Ар╕Ыр╕┤р╕Ф Supabase SQL Editor
2. р╕гр╕▒р╕Щ SQL р╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М: `supabase/add_include_vat_column.sql`

```sql
ALTER TABLE sales_transactions 
ADD COLUMN IF NOT EXISTS include_vat BOOLEAN DEFAULT true;
```

3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ column р╕Цр╕╣р╕Бр╣Ар╕Юр╕┤р╣Ир╕бр╣Бр╕ер╣Йр╕з:

```sql
SELECT column_name, data_type, column_default
FROM information_schema.columns 
WHERE table_name = 'sales_transactions' 
  AND column_name = 'include_vat';
```

---

## ЁЯУ▒ **UI Features:**

### **1. Checkbox "р╕гр╕зр╕б VAT 7%"**
- р╣Ар╕ер╕╖р╕нр╕Б/р╣Др╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Бр╣Др╕Фр╣Й
- Default: р╣Ар╕ер╕╖р╕нр╕Б (true)
- р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Др╕Фр╣Йр╕Хр╕ер╕нр╕Фр╣Ар╕зр╕ер╕▓р╕Бр╣Ир╕нр╕Щр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ

### **2. р╣Бр╕кр╕Фр╕Зр╕вр╕нр╕Ф VAT р╣Бр╕Ър╕Ър╣Др╕Фр╕Щр╕▓р╕бр╕┤р╕Б**
- тЬЕ р╣Ар╕ер╕╖р╕нр╕Б тЖТ р╣Бр╕кр╕Фр╕Зр╕вр╕нр╕Ф VAT р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з (+6,888)
- тЭМ р╣Др╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Б тЖТ р╣Бр╕кр╕Фр╕З 0 р╕Ър╕▓р╕Ч (р╕Вр╕╡р╕Фр╕Жр╣Ир╕▓)

### **3. р╕Др╕│р╣Ар╕Хр╕╖р╕нр╕Щ**
- р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Б VAT р╕Ир╕░р╣Бр╕кр╕Фр╕З: **"тЪая╕П р╕гр╕▓р╕Др╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕гр╕зр╕б VAT"**

### **4. р╕ер╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г**
- р╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕Ф "р╕ер╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г" тЖТ Reset р╣Ар╕Ыр╣Зр╕Щ "р╕гр╕зр╕б VAT" (true)

---

## ЁЯзк **р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ:**

### **Test Case 1: р╕гр╕зр╕б VAT**
1. р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕Хр╕░р╕Бр╕гр╣Йр╕▓
2. тЬЕ р╣Ар╕ер╕╖р╕нр╕Б "р╕гр╕зр╕б VAT 7%"
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ: р╕вр╕нр╕Ф VAT р╣Бр╕кр╕Фр╕Зр╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з (+xxx р╕Ър╕▓р╕Ч)
4. р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
5. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ database: `vat_amount` > 0, `include_vat` = true

### **Test Case 2: р╣Др╕бр╣Ир╕гр╕зр╕б VAT**
1. р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕Хр╕░р╕Бр╕гр╣Йр╕▓
2. тЭМ р╣Др╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Б "р╕гр╕зр╕б VAT 7%"
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ: р╕вр╕нр╕Ф VAT = 0, р╕бр╕╡р╕Др╕│р╣Ар╕Хр╕╖р╕нр╕Щ
4. р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
5. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ database: `vat_amount` = 0, `include_vat` = false

### **Test Case 3: р╕бр╕╡р╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Бр╕ер╕░р╣Ар╕Чр╕┤р╕гр╣Мр╕Щ**
1. р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕┤р╕Щр╕Др╣Йр╕▓, р╕кр╣Ир╕зр╕Щр╕ер╕Ф, р╣Ар╕Чр╕┤р╕гр╣Мр╕Щр╕Чр╕нр╕З
2. р╣Ар╕ер╕╖р╕нр╕Б/р╣Др╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Б VAT
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╕Хр╕▓р╕бр╕кр╕╣р╕Хр╕г
4. р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ database

---

## ЁЯУЛ **Files р╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕В:**

1. тЬЕ `src/hooks/usePOS.ts` - р╣Ар╕Юр╕┤р╣Ир╕б includeVat state р╣Бр╕ер╕░ logic
2. тЬЕ `src/app/pos/page.tsx` - р╣Ар╕Юр╕┤р╣Ир╕б UI checkbox
3. тЬЕ `src/lib/supabaseAPI.ts` - р╣Ар╕Юр╕┤р╣Ир╕б include_vat field
4. тЬЕ `supabase/schema.sql` - р╕нр╕▒р╕Юр╣Ар╕Фр╕Ч schema
5. тЬЕ `supabase/add_include_vat_column.sql` - Migration script

---

## ЁЯОЙ **р╕кр╕гр╕╕р╕Ы:**

р╕гр╕░р╕Ър╕Ъ POS р╕Хр╕нр╕Щр╕Щр╕╡р╣Й:
- тЬЕ р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Б "р╕гр╕зр╕б VAT" р╕лр╕гр╕╖р╕н "р╣Др╕бр╣Ир╕гр╕зр╕б VAT"
- тЬЕ р╕Др╕│р╕Щр╕зр╕У VAT р╕Хр╕▓р╕бр╕кр╕╣р╕Хр╕гр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- тЬЕ р╣Бр╕кр╕Фр╕З UI р╕Кр╕▒р╕Фр╣Ар╕Ир╕Щр╣Бр╕ер╕░р╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕Зр╣Ир╕▓р╕в
- тЬЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╣Гр╕Щ Database
- тЬЕ р╕ер╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г Reset р╣Ар╕Ыр╣Зр╕Щр╕Др╣Ир╕▓ default

---

ЁЯУЕ **р╕нр╕▒р╕Юр╣Ар╕Фр╕Ч:** December 2025  
ЁЯФЧ **р╣Ар╕нр╕Бр╕кр╕▓р╕гр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б:** `INSTALLATION.md`, `POS_FIX_GUIDE.md`

